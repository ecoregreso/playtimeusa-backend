<label>
          Password
          <input
            id="password"
            name="password"
            type="password"
            inputmode="numeric"
            autocomplete="one-time-code"
            required
          />
        </label>
        <button type="submit">Sign in</button>
        <p class="status" id="status" role="status" aria-live="polite"></p>
      </form>

      <div class="balances" id="balances" hidden>
        <strong id="balance"></strong>
        <span>Voucher balance</span>
      </div>

      <footer>
        Need to issue a new voucher? <a href="/cashier.html">Return to the cashier console</a>.
      </footer>
    </main>

    <script>
      const form = document.getElementById('login-form');
      const userCodeInput = document.getElementById('userCode');
      const passwordInput = document.getElementById('password');
      const statusEl = document.getElementById('status');
      const balances = document.getElementById('balances');
      const balanceValue = document.getElementById('balance');

      const setStatus = (message, type) => {
        statusEl.textContent = message;
        statusEl.className = `status ${type ?? ''}`;
      };

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        balances.hidden = true;
        setStatus('Signing inâ€¦');

        try {
          const response = await fetch('/api/player/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              userCode: userCodeInput.value.trim(),
              password: passwordInput.value.trim()
            })
          });

          if (!response.ok) {
            const error = await response.json().catch(() => ({ error: 'Login failed.' }));
            throw new Error(error.error || 'Login failed.');
          }

          const { balance } = await response.json();
          const formatted = new Intl.NumberFormat(undefined, {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: 2
          }).format(balance);

          balanceValue.textContent = formatted;
          balances.hidden = false;
          setStatus('Voucher accepted. Enjoy your games!', 'success');
        } catch (error) {
          console.error(error);
          setStatus(error.message, 'error');
        }
      });

      const params = new URLSearchParams(window.location.search);
      const initialUser = params.get('user');
      const initialPass = params.get('pass');
      if (initialUser) userCodeInput.value = initialUser;
      if (initialPass) passwordInput.value = initialPass;

      if (initialUser && initialPass) {
        passwordInput.type = 'text';
        setTimeout(() => {
          passwordInput.type = 'password';
        }, 2000);
        setTimeout(() => {
          form.requestSubmit();
        }, 150);
      }
    </script>
    <script defer src="./static/js/lib-axios.ab755785.js"></script>
    <script defer src="./static/js/lib-router.a5936d7d.js"></script>
    <script defer src="./static/js/lib-react.7650d57a.js"></script>
    <script defer src="./static/js/307.0cc8af9e.js"></script>
    <script defer src="./static/js/index.a7150d49.js"></script>
  </body>
</html>
