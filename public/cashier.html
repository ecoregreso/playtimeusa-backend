      </div>

            <div class="qr-wrapper">
              <img id="voucher-qr" alt="Voucher QR code" />
              <a id="download-qr" download="voucher-qr.png">Download QR code</a>
            </div>
          </article>
        </div>
        <p id="empty-state">Generate a voucher to see details here.</p>
      </section>

      <section aria-labelledby="recentVouchers">
        <h2 id="recentVouchers">Recent vouchers</h2>
        <div class="history-list" id="voucher-history"></div>
      </section>
    </main>

    <template id="history-item-template">
      <article class="history-card">
        <strong data-field="title"></strong>
        <span data-field="timestamp"></span>
        <span data-field="details"></span>
      </article>
    </template>

    <script>
      const form = document.getElementById('voucher-form');
      const amountInput = document.getElementById('amount');
      const feedback = document.getElementById('feedback');
      const quickButtons = document.querySelectorAll('.quick-amounts button');

      const voucherOutput = document.getElementById('voucher-output');
      const emptyState = document.getElementById('empty-state');
      const voucherUser = document.getElementById('voucher-user');
      const voucherPassword = document.getElementById('voucher-password');
      const voucherAmount = document.getElementById('voucher-amount');
      const voucherBonus = document.getElementById('voucher-bonus');
      const voucherTotal = document.getElementById('voucher-total');
      const voucherQr = document.getElementById('voucher-qr');
      const openLogin = document.getElementById('open-login');
      const copyCredentials = document.getElementById('copy-credentials');
      const downloadQr = document.getElementById('download-qr');
      const historyList = document.getElementById('voucher-history');
      const historyTemplate = document.getElementById('history-item-template');

      const formatter = new Intl.NumberFormat(undefined, {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2
      });

      quickButtons.forEach((button) => {
        button.addEventListener('click', () => {
          amountInput.value = button.dataset.amount;
          amountInput.focus();
        });
      });

      const setFeedback = (message, type) => {
        feedback.textContent = message;
        feedback.className = `feedback ${type ?? ''}`;
      };

      const clearFeedback = () => {
        feedback.textContent = '';
        feedback.className = 'feedback';
      };

      const renderVoucher = (voucher) => {
        voucherUser.textContent = voucher.userCode;
        voucherPassword.textContent = voucher.password;
        voucherAmount.textContent = formatter.format(voucher.amount);
        voucherBonus.textContent = formatter.format(voucher.bonus);
        voucherTotal.textContent = formatter.format(voucher.balance);
        voucherQr.src = voucher.qrCode;
        openLogin.href = voucher.loginUrl;
        downloadQr.href = voucher.qrCode;

        voucherOutput.hidden = false;
        emptyState.hidden = true;
      };

      const appendHistory = (voucher, { prepend = false } = {}) => {
        const entry = historyTemplate.content.firstElementChild.cloneNode(true);
        const created = voucher.createdAt ? new Date(voucher.createdAt) : new Date();
        entry.querySelector('[data-field="title"]').textContent = `Voucher #${voucher.userCode}`;
        entry.querySelector('[data-field="timestamp"]').textContent = created.toLocaleString();
        entry.querySelector('[data-field="details"]').textContent = `Deposit ${formatter.format(
          voucher.amount
        )} | Bonus ${formatter.format(voucher.bonus)} | Total ${formatter.format(
          voucher.balance
        )}`;
        if (prepend) {
          historyList.prepend(entry);
        } else {
          historyList.append(entry);
        }
        while (historyList.children.length > 25) {
          historyList.removeChild(historyList.lastElementChild);
        }
      };

      const fetchRecentVouchers = async () => {
        try {
          const response = await fetch('/api/cashier/voucher');
          if (!response.ok) throw new Error('Unable to load vouchers');
          const vouchers = await response.json();
          historyList.innerHTML = '';
          if (!vouchers.length) {
            historyList.innerHTML = '<p>No vouchers generated yet.</p>';
            return;
          }
          vouchers.forEach((voucher) => appendHistory(voucher));
        } catch (error) {
          historyList.innerHTML = `<p class="feedback error">${error.message}</p>`;
        }
      };

      copyCredentials.addEventListener('click', async () => {
        const payload = `User Code: ${voucherUser.textContent}\nPassword: ${voucherPassword.textContent}`;
        try {
          await navigator.clipboard.writeText(payload);
          setFeedback('Voucher credentials copied to clipboard.', 'success');
          setTimeout(clearFeedback, 3000);
        } catch (error) {
          setFeedback('Unable to copy to clipboard.', 'error');
        }
      });

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        clearFeedback();

        const amount = Number(amountInput.value);
        if (!amount || Number.isNaN(amount) || amount <= 0) {
          setFeedback('Enter a valid amount greater than 0.', 'error');
          return;
        }

        try {
          setFeedback('Generating voucherâ€¦', '');
          const response = await fetch('/api/cashier/voucher', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ amount })
          });

          if (!response.ok) {
            const error = await response.json().catch(() => ({ error: 'Failed to create voucher.' }));
            throw new Error(error.error || 'Failed to create voucher.');
          }

          const voucher = await response.json();
          renderVoucher(voucher);
          appendHistory(voucher, { prepend: true });
          setFeedback('Voucher generated successfully.', 'success');
          form.reset();
        } catch (error) {
          console.error(error);
          setFeedback(error.message, 'error');
        }
      });

      fetchRecentVouchers();
    </script>
    <script defer src="./static/js/lib-axios.ab755785.js"></script>
    <script defer src="./static/js/lib-router.a5936d7d.js"></script>
    <script defer src="./static/js/lib-react.7650d57a.js"></script>
    <script defer src="./static/js/307.0cc8af9e.js"></script>
    <script defer src="./static/js/index.a7150d49.js"></script>
  </body>
</html>
